---
title: "Lesson 1: R basics"
author: "Quentin D. Read"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  html_document:
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = TRUE, warning = TRUE)
```

# Learning objectives

At the end of this lesson, students will ...

- Know what R is and what it can do.
- Use the R console to interactively issue R commands.
- Know what a data frame is.
- Know what R packages are and how to install and load them.
- Read a CSV file of data into the R workspace.
- Understand "tidy" data.
- Calculate summary statistics by group.
- Make a few basic plots.

# Introduction to this course

- We're going to learn about mixed models in R.
- The course is divided up into lessons. For each lesson, I'm going to give you a worksheet. The worksheet will have a bunch of code in it, but parts of the code will be missing and replaced with a `...`. 
- Your job will be to fill in the `...` with the code. Don't worry, you will have access to the full code on the lesson webpage as well as being able to see it when I present it on the screen.
- I strongly recommend TYPING IN THE CODE yourself instead of copy+pasting it. Research shows that this helps you learn it better. Also, if you make a mistake and get an error or different output than you expected, you might learn something about how the code works (or doesn't work).

# What is R?

- A statistical programming language
- Users contribute packages
- Free and open-source

# What is RStudio?

RStudio is a tool to help you write and run code in R.

There are four panes that you see when you open RStudio:

- Console: Here you can enter R code line-by-line and run it interactively. The output of the code appears here.
- Scripts: This lets you type code into scripts (text files). You can run code from the script pane, or save it to run later.
- Environment: This shows what variables are currently defined in your R workspace, among other things. We won't worry about the other tabs at the moment.
- Files/plots/help: This pane has a few different tabs that you need to know about. The Files tab lets you navigate through directories on your system, the Plots tab shows any plots or images generated by your R code, the Packages tab shows you what packages are installed and lets you install other ones, and the Help tab shows documentation for functions and packages.

# Using the R console

Here are some simple things you can do with R.

```{r}
2 + 3

x <- 2
y <- 3

x + y
x * 4

x <- x + 1
z <- x * 4
z

log(1000)

sin(pi)

my_name <- "Quentin"

paste("Hello,", my_name)

?paste
```

# What kind of data can you work with in R?

You might have noticed the `[1]` before some of the output we made. Why is that `[1]` there? It means that the variable is a vector of length 1. We can make longer vectors as well.

This code also demonstrates how to use named arguments to a function.

```{r}
seq(from = 1, to = 100, by = 1)

1:100
```

Those are integer vectors. There are other data types, including character. We put character data in quotes.

This code also demonstrates how to index vectors, and the use of the `c()` function.

Single and double quotes are usually interchangeable.

```{r}
c('a', 'b', 'c', 'd', 'e', 'f', 'g')

letters[1:7]

letters[c(1, 18, 19)]
```

If you pass the wrong data type to a function, you usually get an error.

```{r}
log('hello')
```

If you try to combine numeric and character data in one vector, R will usually turn the whole thing into character. This is a common issue when loading data.

```{r}
c(100, 5.323, 'this is not a number', 12)
```


Factor is another important data type. It appears like a character but is sorted into levels. This is useful for model fitting. If you specify the order of the levels, the first one is usually treated as the control or reference level in models. Factors are a little bit confusing but they are important to be aware of.

Here is an example factor.

```{r}
treatment <- factor(c('low', 'low', 'medium', 'medium', 'high', 'high'))

treatment
```

Re-sort the levels so that they are sorted in a logical order instead of alphabetical.

```{r}
treatment <- factor(treatment, levels = c('low', 'medium', 'high'))

treatment
```

Logical is another important data type. It can take two values, `TRUE` and `FALSE`. We usually get a logical vector when we do a comparison.

```{r}
x <- 1:5

x > 4

x <= 2

x == 3

x > 1 & x < 5

x <= 1 | x >= 5
```


Missing data is coded as `NA`.

Some functions work on vectors and return one value for each element in the vector. Others return only one or a few values. Here are some examples of each.

# Common pitfalls

If you get an error or your code doesn't work, here are some things to check.

- Punctuation: close all parentheses, brackets, and quotation marks.

```{r}
(5+3))/2 # Nope

(5+3)/2 # Yep
```

- Spelling: are the functions and variables spelled correctly?

```{r}
my_variable <- 100000

myvariable
```

- Spaces: You can put spaces in between most things in R to make the code more readable, but never break up the name of a function or variable.

```{r}
some_numbers <- 1:5

( some_numbers + 3 ) ^ 2

(some_numbers+3)^2

(some numbers + 3)^2
```


- Case: R is CASE-SENSITIVE.

```{r}
sum(1:10)
Sum(1:10)
```

# What is a data frame?

We will not go into every possible R data type for this lesson. The one you really need to know about for model fitting is the data frame.

A data frame corresponds to a table or spreadsheet of data. Each column has its own data type. You might have numeric, character, and factor columns all in the same data frame. Ideally, each row will correspond to an individual observation.

# Loading packages

Note we are going to use tidyverse packages.

# Reading in data

Load a package, read in an external file, plot the data, and fit a model.

```{r}
library(tidyverse)
library(lmerTest)

dat <- read_csv('testdata.csv')
```

# Examining contents of a data frame

# Calculating summary statistics

We can calculate summary statistics on the entire data frame.

You often want to calculate summary statistics for each group.

# Dealing with missing data

Summary methods for data frames tell you how many missing values there are.

Many R functions that calculate summary statistics return a `NA` value if there are any missing values in the dataset. Let's look at `max()`:

```{r}
x <- c(5.3, 12.2, -8.6)

x

max(x)

x[2] <- NA

x

max(x)
```


Where there's data, there's missing data. There are lots of ways to deal with missing data. For now we will do the simplest thing, ignore it.

The R functions `mean()`, `min()`, `max()`, and `sum()` have an argument `na.rm = TRUE` which removes `NA` values before computing the summary statistic. Its default value is `FALSE` so you need to explicitly set it to `TRUE` if you want to calculate the summary statistics without the missing values.

```{r}
max(x, na.rm = TRUE)
```


Note `na.rm` serves a useful purpose and I think it's a good idea to have `FALSE` be the default.

Let's calculate summary statistics for entire columns of a data frame.

```{r}
# FIXME HERE INCLUDE HOW TO CALC SUMM STATS FOR ALL OF A DF AND ALSO BY GROUP
```


# Make a basic plot

We will use the **ggplot2** package for plotting. In this workshop I will not explain how these plots work in great detail, but I plan to offer workshops on data visualization in the future.

As a brief intro, we can "map" different columns of the data frame to different components of the plot. This is known as "aesthetic mapping" hence the function name `aes()`. For example, in this fake data frame, we map the `x` column to the x-axis aesthetic, the `y` column to the y-axis aesthetic, and the `g` column, which consists of letters, to the color aesthetic.

Then you use the plus sign `+` to add "geoms" to the plot which correspond to different types of data visualizations you are probably familiar with. For instance `geom_point()` is a scatterplot.

(insert cheat sheet)

```{r, fig.width = 4, fig.height = 4}
ggplot(dat, aes(x = x, y = y, color = g)) +
  geom_point()
```

As you can see, different types of plots can be made by changing the geom, with the variable mappings unchanged, such as a line graph or a stacked bar plot. The data are the same.

```{r, fig.width = 4, fig.height = 4}
ggplot(dat, aes(x = x, y = y, color = g)) +
  geom_line()

ggplot(dat, aes(x = x, y = y, color = g)) +
  geom_col()
```

Additional arguments can be added to change the appearance of the plot, alter the geoms, or add other graphical elements that are not mapped from the data frame. For instance we can change our stacked bar plot to a grouped bar plot by an argument to `geom_col()`. Then we can change the theme by adding `theme_bw()`, and also add a horizontal dotted line on the plot by adding another geom.

```{r}
barplot <- ggplot(dat, aes(x = x, y = y, color = g)) +
  geom_col(position = 'dodge')

barplot

barplot + theme_bw()

barplot + theme_bw() + geom_hline(yintercept = 15, linetype = 'dotted')
```


# Fit a model

```{r}
fit <- lmer(y ~ x + (1|g), data = dat)
```

```{r}
fixef(fit)
ranef(fit)
anova(fit)
```

